<!doctype html>
<html lang="en">

<head>
  <title>RideOrDrive</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900|Raleway" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css')}}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css')}}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.min.css')}}">

  <link rel="stylesheet" href="{{ url_for('static', filename='fonts/ionicons/css/ionicons.min.css')}}">
  <link rel="stylesheet" href="{{ url_for('static', filename='fonts/fontawesome/css/font-awesome.min.css')}}">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css')}}">

</head>

<body>

  <header role="banner">

    <nav class="navbar navbar-expand-md navbar-dark bg-light">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('static', filename='index.html')}}">RideOrDrive</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample05"
          aria-controls="navbarsExample05" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse navbar-light" id="navbarsExample05">
          <ul class="navbar-nav ml-auto pl-lg-5 pl-0">
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('static', filename='index.html')}}">Home</a>
            </li>
            {% if current_user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('static', filename='history.html')}}">History</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="/logout">Logout</a>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('static', filename='login.html')}}">Login</a>
            </li>
            {% endif %}

          </ul>

        </div>
      </div>
    </nav>
  </header>
  <!-- END header -->
  <section class="site-hero site-hero-innerpage overlay" data-stellar-background-ratio="0.5"  style="background-image: url('/static/images/big_image_1.jpg')">
    <div class="container">
      <div class="row align-items-center site-hero-inner justify-content-center">
        <div class="col-md-8 text-center">

          <div class="mb-5 element-animate">
            <h1>Your Destination. Your Choice.</h1>
          </div>
        </div>
      </div>
    </div>

    <div class="row">

      <!-- Left Box -->
      <div class="col-lg-8">
          <div class="embed-responsive embed-responsive-1by1" >
              <div id="map-container" class="embed-responsive-item" >
                    <div id="map"></div>
              </div> 
           </div>

      </div>

      <!-- Right Box -->
      <div class="col-lg-4" style="overflow-y: scroll;height: 900px">

          <!-- Cards Rows -->
          <div class="row" style="overflow-y: scroll" >
              <div class="col-sm-10" >
                  <div class="card mb-3 mb-lg-2">
                      <div class="card-body">
                        <h5 class="card-title text-muted text-uppercase text-center">Weather</h5>
                        <h6 class="card-price text-center"><span class="period"></span></h6>
                        <hr>
                        <ul class="fa-ul" id="weather">
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>First Option</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Second Option</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Third Option </li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Third Option </li>
                        </ul>
                      </div>
                    </div>
              </div>

              <!-- Card #1 -->
              <div class="col-sm-10">
                  <div class="card mb-7 mb-lg-2">
                      <div class="card-body">
                        <h5 class="card-title text-muted text-uppercase text-center">Uber</h5>
                        <h6 class="card-price text-center"><span class="period"></span></h6>
                        <hr>
                        <ul class="fa-ul" id="uber">
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>First Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Second Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Third Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Fourth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Fifthe Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none" ><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                        </ul>
                        <a class="btn btn-block btn-primary text-white text-uppercase" onclick="requestUber()">Request Uber</a>
                      </div>
                    </div>
              </div>
                
              <!-- Card #2 -->
              <div class="col-sm-10">
                <div class="card mb-7 mb-lg-2">
                    <div class="card-body">
                      <h5 class="card-title text-muted text-uppercase text-center">Lyft</h5>
                      <h6 class="card-price text-center"><span class="period"></span></h6>
                      <hr>
                      <ul class="fa-ul" id="lyft">
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>First Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Second Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Third Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Fourth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Fifthe Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                          <li style="display:none"><span class="fa-li"><i class="fas fa-check"></i></span>Sixth Option - cost</li>
                      </ul>
                      <a class="btn btn-block btn-primary text-white text-uppercase" onclick="requestLyft()">Request Lyft</a>
                    </div>
                  </div>
            </div>

              <!-- Card #3 -->
              <div class="col-sm-10">
                  <div class="card mb-7 mb-lg-2">
                      <div class="card-body">
                        <h5 class="card-title text-muted text-uppercase text-center">Parking Garage</h5>
                        <h6 class="card-price text-center"><span class="period"></span></h6>
                        <hr>
                        <ul class="fa-ul" id = "lots">
                            <li style="display:none" onclick="Click1()" ><span class="fa-li"><i class="fas fa-check"></i></span>First Option - cost</li>
                            <li style="display:none" onclick="Click2()" ><span class="fa-li"><i class="fas fa-check"></i></span>Second Option - cost</li>
                            <li style="display:none" onclick="Click3()" ><span class="fa-li"><i class="fas fa-check"></i></span>Third Option - cost</li>
                            <li style="display:none" onclick="Click4()" ><span class="fa-li"><i class="fas fa-check"></i></span>Fourth Option - cost</li>
                            <li style="display:none" onclick="Click5()" ><span class="fa-li"><i class="fas fa-check"></i></span>Fifthe Option - cost</li>
                        </ul>
                       <!-- <a class="btn btn-block btn-primary text-white text-uppercase">Button</a> -->
                      </div>
                    </div>
              </div>

             

          </div>

      </div>

  </div>
  </section>





  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript">
    // var params = {};

    // if (location.search) {
    // var parts = location.search.substring(1).split('&');

    // for (var i = 0; i < parts.length; i++) {
    //     var nv = parts[i].split('=');
    //     if (!nv[0]) continue;
    //     params[nv[0]] = nv[1] || true;
    //   }
    // }

    //source var from input and destination var
    // var source = params.source;
    // document.getElementById("start").value = source;
    // var destination = params.destination;
    //  document.getElementById("end").value = destination;

    var source = "{{ source }}";
    var destination = "{{ destination }}";
    var uber_stuff = {{ uber | tojson }};
    var weather_details = {{ weather | tojson }};

    var weather_card = document.querySelectorAll("#weather > li");
    weather_card[0].innerHTML = "Overview: " + weather_details['desc'];
    weather_card[0].style.display = 'block';
    weather_card[1].innerHTML = "Temp: " + weather_details['temp'];
    weather_card[2].innerHTML = "Vis.: " + weather_details['visibility'];
    weather_card[3].innerHTML = "Humidity: " + weather_details['humidity'];
    weather_card[1].style.display = 'block';
    weather_card[2].style.display = 'block';
    weather_card[3].style.display = 'block';

    var lotsMarkers = {{lotsMarkers | tojson}};

    var uber_box = document.querySelectorAll("#uber > li");
if(Object.keys(uber_stuff).length === 0 && uber_stuff.constructor === Object){
    uber_box[0].innerHTML = "Distance too far (>100mi), use Uber client for accurate estimate.";
    uber_box[0].style.display = 'block';
}else {
    for(i = 0; i < uber_stuff['prices'].length; i++){
      uber_box[i].innerHTML = uber_stuff['prices'][i]['display_name'] + " - " + uber_stuff['prices'][i]['estimate'];
      uber_box[i].style.display = 'block';
    }
}

    var lyft_stuff = {{ lyft | tojson }};
    
if(Object.keys(lyft_stuff).length === 0 && lyft_stuff.constructor === Object){
    console.log('No lyft rides found');
          }else{

    var lyft_box = document.querySelectorAll("#lyft > li");
    for(i = 0; i < lyft_stuff['cost_estimates'].length; i++){
        var curr = lyft_stuff['cost_estimates'][i];
      lyft_box[i].innerHTML = curr['display_name'] + " - " + "$" + curr['estimated_cost_cents_min']/100 + "-" + curr['estimated_cost_cents_max']/100;
        lyft_box[i].style.display = 'block';
    }
}
    var lots_stuff = {{ lots | tojson }};





    // var myURL= "https://m.uber.com/?client_id=n0W4YyBkA8BvBSt7UtKTHGvISpyR22ga&action=setPickup&pickup[latitude]=37.775818&pickup[longitude]=-122.418028&pickup[nickname]=UberHQ&pickup[formatted_address]=1455%20Market%20St%2C%20San%20Francisco%2C%20CA%2094103&dropoff[latitude]=37.802374&dropoff[longitude]=-122.405818&dropoff[nickname]=Coit%20Tower&dropoff[formatted_address]=1%20Telegraph%20Hill%20Blvd%2C%20San%20Francisco%2C%20CA%2094133&product_id=a1111c8c-c720-46c3-8534-2fcdd730040d&link_text=View%20team%20roster&partner_deeplink=partner%3A%2F%2Fteam%2F9383";
    var myURL="";

    function requestUber() {

        var slat = "{{slat}}", slong = "{{slong}}", dlat = "{{dlat}}", dlong = "{{dlong}}";
        var sourceURL = "{{sourceURL}}";
        var destinationURL = "{{destinationURL}}"

        myURL = "https://m.uber.com/?client_id=n0W4YyBkA8BvBSt7UtKTHGvISpyR22ga&action=setPickup&pickup[latitude]=" + slat + "&pickup[longitude]=" + slong + "&pickup[nickname]=" + sourceURL + "&dropoff[latitude]=" + dlat + "&dropoff[longitude]=" + dlong + "&dropoff[nickname]=" + destinationURL + "&product_id=a1111c8c-c720-46c3-8534-2fcdd730040d";

        window.location.href = myURL;
    }


    function requestLyft() {

        var slat = "{{slat}}", slong = "{{slong}}", dlat = "{{dlat}}", dlong = "{{dlong}}";
        var myLyftURL= "https://ride.lyft.com/request?destination=@"+dlat+","+dlong+"&pickup=@"+slat+","+slong+"&rideType=lyft";


        window.location.href = myLyftURL;
    }


    var lots_box = document.querySelectorAll("#lots > li");
    if(lots_stuff.length == 0) {
        lots_box[0].innerHTML = "No Available Parking Lots Online Near Destination";
        lots_box[0].style.display = "block";
    } else{
    for(i = 0; i < lots_stuff.length; i++){
        var curr = lots_stuff[i];
        lots_box[i].innerHTML = (("Opt. " + (i+1)).bold() + ": " +curr['name'] + "<br />"+ ("Price: "  + curr['price, hourly']).bold() + " <br />").link("#lots");
        lots_box[i].style.display = "block";}
    }



    function Click1(){
      var url =  "https://www.google.com/maps/dir/?api=1&origin="+source+"&destination="+lotsMarkers[0]['address']+"&travelmode=traffic";
      window.open(url,'_blank');
    }
    function Click2(){
      var url =  "https://www.google.com/maps/dir/?api=1&origin="+source+"&destination="+lotsMarkers[1]['address']+"&travelmode=traffic";
      window.open(url,'_blank');
    }
    function Click3(){
      var url =  "https://www.google.com/maps/dir/?api=1&origin="+source+"&destination="+lotsMarkers[2]['address']+"&travelmode=traffic";
      window.open(url,'_blank');
    }
    function Click4(){
      var url =  "https://www.google.com/maps/dir/?api=1&origin="+source+"&destination="+lotsMarkers[3]['address']+"&travelmode=traffic";
      window.open(url,'_blank');
    }
    function Click5(){
      var url =  "https://www.google.com/maps/dir/?api=1&origin="+source+"&destination="+lotsMarkers[4]['address']+"&travelmode=traffic";
      window.open(url,'_blank');
    }




    var geocoder = new google.maps.Geocoder();
    var address = source;
    var slat;
    var slong;
    geocoder.geocode({ 'address': address }, function (results, status) {

      if (status == google.maps.GeocoderStatus.OK) {
        var latitude = results[0].geometry.location.lat();
        var longitude = results[0].geometry.location.lng();
        window.slat = results[0].geometry.location.lat();
        window.slong = results[0].geometry.location.lng();

      }
    });


    var address = destination;
    var dlat;
    var dlong;
    geocoder.geocode({ 'address': address }, function (results, status) {

      if (status == google.maps.GeocoderStatus.OK) {
        var latitude = results[0].geometry.location.lat();
        var longitude = results[0].geometry.location.lng();
        window.dlat = results[0].geometry.location.lat();
        window.dlong = results[0].geometry.location.lng();

      }
    });


    function initMap() {
      var directionsService = new google.maps.DirectionsService;
      var directionsDisplay = new google.maps.DirectionsRenderer;
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7,
        center: { lat: 41.85, lng: -87.65 }
      });
      directionsDisplay.setMap(map);


      calculateAndDisplayRoute(directionsService, directionsDisplay);




          var myLatlng0 = new google.maps.LatLng(lotsMarkers[0]['mlat'],lotsMarkers[0]['mlong']);
          var myLatlng1 = new google.maps.LatLng(lotsMarkers[1]['mlat'],lotsMarkers[1]['mlong']);
          var myLatlng2 = new google.maps.LatLng(lotsMarkers[2]['mlat'],lotsMarkers[2]['mlong']);
          var myLatlng3 = new google.maps.LatLng(lotsMarkers[3]['mlat'],lotsMarkers[3]['mlong']);
          var myLatlng4 = new google.maps.LatLng(lotsMarkers[4]['mlat'],lotsMarkers[4]['mlong']);

          var infowindow0 = new google.maps.InfoWindow({
          content: lotsMarkers[0]['name']
        });
          var infowindow1 = new google.maps.InfoWindow({
          content: lotsMarkers[1]['name']
        });
          var infowindow2 = new google.maps.InfoWindow({
          content: lotsMarkers[2]['name']
        });
          var infowindow3 = new google.maps.InfoWindow({
          content: lotsMarkers[3]['name']
        });
          var infowindow4 = new google.maps.InfoWindow({
          content: lotsMarkers[4]['name']
        });


          var marker0 = new google.maps.Marker({
            position: myLatlng0,
            title: lotsMarkers[0]['name']
        });
          var marker1 = new google.maps.Marker({
            position: myLatlng1,
            title: lotsMarkers[1]['name']
        });
          var marker2 = new google.maps.Marker({
            position: myLatlng2,
            title: lotsMarkers[2]['name']
        });
          var marker3 = new google.maps.Marker({
            position: myLatlng3,
            title: lotsMarkers[3]['name']
        });
          var marker4 = new google.maps.Marker({
            position: myLatlng4,
            title: lotsMarkers[4]['name']
        });


          marker0.addListener('click', function() {
          infowindow0.open(map, marker0);
        });marker1.addListener('click', function() {
          infowindow1.open(map, marker1);
        });marker2.addListener('click', function() {
          infowindow2.open(map, marker2);
        });marker3.addListener('click', function() {
          infowindow3.open(map, marker3);
        });marker4.addListener('click', function() {
          infowindow4.open(map, marker4);
        });


        // To add the marker to the map, call setMap();
        marker0.setMap(map);
        marker1.setMap(map);
        marker2.setMap(map);
        marker3.setMap(map);
        marker4.setMap(map);




    }

    function calculateAndDisplayRoute(directionsService, directionsDisplay) {
      directionsService.route({
        origin: source,
        destination: destination,
        travelMode: 'DRIVING'
      }, function (response, status) {
        if (status === 'OK') {
          directionsDisplay.setDirections(response);
        } else {
          window.alert('Directions request failed due to ' + status);
        }
      });
    }

  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPtG_CNX2p16z-usOgiwuOifAR9VpwJK4&callback=initMap">
  </script>
  <div id="loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
      <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
      <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#f4b214" /></svg></div>

  <script src="{{ url_for('static', filename='js/jquery-3.2.1.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/jquery-migrate-3.0.0.js')}}"></script>
  <script src="{{ url_for('static', filename='js/popper.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/bootstrap.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/owl.carousel.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/jquery.waypoints.min.js')}}"></script>
  <script src="{{ url_for('static', filename='js/jquery.stellar.min.js')}}"></script>

  <script src="{{ url_for('static', filename='js/main.js')}}"></script>

</body>

</html>
